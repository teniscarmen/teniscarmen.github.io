<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Migrar Firestore A ‚ûú B</title>
</head>
<body style="font-family: sans-serif; padding: 20px;">
  <h2>Migraci√≥n Firestore: Proyecto A ‚ûú Proyecto B</h2>
  <button id="migrarBtn">Iniciar migraci√≥n</button>
  <pre id="log" style="margin-top:20px; background:#f4f4f4; padding:10px; max-height: 400px; overflow-y: auto;"></pre>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-app.js";
    import { getFirestore, collection, doc, getDocs, setDoc, listCollections } from "https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore.js";

    const log = document.getElementById("log");

    // Configuraci√≥n de Proyecto A (cuenta personal)
    const configA = {
      apiKey: "AIzaSyCe_HbdWlApCldi2Rk8uituDIwr_RcjAqE",
      authDomain: "tenis-1baf2.firebaseapp.com",
      projectId: "tenis-1baf2",
      storageBucket: "tenis-1baf2.firebasestorage.app",
      messagingSenderId: "1063958178043",
      appId: "1:1063958178043:web:01276f257cc083bac1285e",
      measurementId: "G-XXEEL6LMND"
    };

    // Configuraci√≥n de Proyecto B (cuenta propia)
    const configB = {
      apiKey: "AIzaSyABlVZR55dbT8KfuEVbnxhquwWP0VbLBy4",
      authDomain: "tenis-chidos-ags.firebaseapp.com",
      projectId: "tenis-chidos-ags",
      storageBucket: "tenis-chidos-ags.firebasestorage.app",
      messagingSenderId: "13324233273",
      appId: "1:13324233273:web:d7eb9f5a0e8ed0a4317be8"
    };

    let dbA, dbB;

    function inicializarAmbas() {
      const appA = initializeApp(configA, "appA");
      const appB = initializeApp(configB, "appB");

      dbA = getFirestore(appA);
      dbB = getFirestore(appB);
    }

    async function migrarDatos() {
      log.textContent = "‚è≥ Iniciando migraci√≥n...\n";

      try {
        inicializarAmbas();

        const colecciones = await listCollections(dbA);

        for (const colRef of colecciones) {
          const colName = colRef.id;
          log.textContent += `\nüìÅ Colecci√≥n: ${colName}`;

          const snapshot = await getDocs(collection(dbA, colName));
          for (const docSnap of snapshot.docs) {
            const data = docSnap.data();
            await setDoc(doc(dbB, colName, docSnap.id), data);
            log.textContent += `\n   ‚úî Copiado: ${colName}/${docSnap.id}`;
          }
        }

        log.textContent += `\n\n‚úÖ Migraci√≥n completada con √©xito.`;
      } catch (error) {
        log.textContent += `\n‚ùå Error: ${error.message}`;
      }
    }

    document.getElementById("migrarBtn").addEventListener("click", migrarDatos);
  </script>
</body>
</html>
